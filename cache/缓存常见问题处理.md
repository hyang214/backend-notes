# 缓存常见问题处理


## 缓存穿透

### 问题描述
缓存穿透，是指查询一个数据库一定不存在的数据。正常的使用缓存流程大致是，数据查询先进行缓存查询，如果key不存在或者key已经过期，再对数据库进行查询，并把查询到的对象，放进缓存。如果数据库查询对象为空，则不放进缓存。

### 解决方案
1. 对于不存在的key，也在缓存中存储一个较短时间的特殊值，表示其代表对于的key不存在数据
	+ 如果请求很多不存在的key，依旧会把大量的请求击穿到DB层
2. 使用布隆过滤器，记录全部存在的key，那么不存储的key大概率通过不了过滤
	+ 如果攻击者找到了一个能过检测的不存在key，还是会导致缓存击穿

所以，可以考虑结合 1 和 2，一起使用


## 缓存雪崩

### 问题描述
缓存雪崩，是指在某一个时间段，缓存集中过期失效。

### 解决方案
1. 对于不同的key的过期时间，不要设置成一样的，对于过期时间，在基本过期时间的基础上，引入随机变量，使得每个key的过期时间都不一致，减少大量key集中过期的可能
2. 缓存全部设置为不过期，然后更新的时候，手动触发更新
	+ 全量更新和写入的时候，也会有大量的DB访问，需要控制速率
	+ 全量数据，容易产生由于缓存导致的不一致，且不会自动修复


## 缓存击穿

### 问题描述
缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。

### 解决方案
1. 对热点数据，做特殊的处理，如缓存时间设置，或者永久


## Reference
[实例解读什么是Redis缓存穿透、缓存雪崩和缓存击穿](https://baijiahao.baidu.com/s?id=1619572269435584821&wfr=spider&for=pc)











