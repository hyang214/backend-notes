# 限流算法

## 计数器限流
计数器是最简单粗暴的算法。例如：一个服务每秒能处理100个请求。设置一个1s的滑动窗口，窗口有10个格子，每个格子100ms，每100ms移动一次，每次移动都记录当前服务请求的次数。内存中保存最近10次的次数（LinkedList）。格子每次移动的时候判断一次，最后一个格子和第一个格子的次数是否相差100，如果超过，则进行限流。
当格子划分的越多，那么滑动窗口的滚动越平滑，限流的统计就会越精确。
+ 如果对应每个请求，按照请求的毫秒/微秒 时间记录一条记录(定时过期)，这样的情况下，就实现了最精确的控制

## 令牌桶算法
一个固定大小的桶：瞬间支持的最大请求数目
固定速率向桶里放令牌：一定时间内，支持的请求数目
每个请求到来，就申请token，拿到token，就继续，否则等待
支持突发大量请求

+ 实现：用一个set来存储令牌（需要线程安全），每个请求尝试从中取出令牌，成功就进行处理

## 漏桶算法
一个固定大小的漏斗：最多缓存的请求数目
固定速率流出：一定时间，处理的请求的数目
每个请求来了进行排队，等待处理

+ 实现：用一个先进先出的队列来实现，定时将其中头部的一定速率的请求取出，进行处理，处理完成的请求删除掉

## Reference
[限流:漏桶算法和令牌桶算法](https://maiyang.me/post/2017-05-28-rate-limit-algorithm/)